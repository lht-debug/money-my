<!DOCTYPE html>
<html lang="zh-CN">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
Â  Â  <title>è´¢åŠ¡ç®¡å®¶ (éŸ³æ•ˆåŠ¨æ•ˆç‰ˆ)</title>
Â  Â  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
Â  Â  <style>
Â  Â  Â  Â  :root {
Â  Â  Â  Â  Â  Â  --primary: #4e54c8;
Â  Â  Â  Â  Â  Â  --primary-light: #8f94fb;
Â  Â  Â  Â  Â  Â  --success: #00b894;
Â  Â  Â  Â  Â  Â  --danger: #ff7675;
Â  Â  Â  Â  Â  Â  --warning: #fdcb6e;
Â  Â  Â  Â  Â  Â  --bg: #f7f8fa;
Â  Â  Â  Â  Â  Â  --card-bg: #ffffff;
Â  Â  Â  Â  Â  Â  --nav-height: 60px;
Â  Â  Â  Â  Â  Â  --safe-area-bottom: env(safe-area-inset-bottom);
Â  Â  Â  Â  }

Â  Â  Â  Â  * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  body {
Â  Â  Â  Â  Â  Â  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
Â  Â  Â  Â  Â  Â  background-color: var(--bg);
Â  Â  Â  Â  Â  Â  color: #333;
Â  Â  Â  Â  Â  Â  margin: 0; padding: 0;
Â  Â  Â  Â  Â  Â  height: 100vh; height: 100dvh;
Â  Â  Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  Â  Â  display: flex; flex-direction: column;
Â  Â  Â  Â  }

Â  Â  Â  Â  #app {
Â  Â  Â  Â  Â  Â  flex: 1; position: relative; overflow: hidden;
Â  Â  Â  Â  Â  Â  width: 100%; max-width: 600px; margin: 0 auto;
Â  Â  Â  Â  Â  Â  background: #fff; box-shadow: 0 0 20px rgba(0,0,0,0.05);
Â  Â  Â  Â  Â  Â  display: flex; flex-direction: column;
Â  Â  Â  Â  }

Â  Â  Â  Â  .view-container {
Â  Â  Â  Â  Â  Â  flex: 1; overflow-y: auto; padding: 20px;
Â  Â  Â  Â  Â  Â  padding-bottom: calc(var(--nav-height) + var(--safe-area-bottom) + 20px);
Â  Â  Â  Â  Â  Â  display: none; opacity: 0; transition: opacity 0.2s ease;
Â  Â  Â  Â  Â  Â  -webkit-overflow-scrolling: touch;
Â  Â  Â  Â  }
Â  Â  Â  Â  .view-container.active { display: block; opacity: 1; }

Â  Â  Â  Â  /* === åº•éƒ¨å¯¼èˆª === */
Â  Â  Â  Â  .bottom-nav {
Â  Â  Â  Â  Â  Â  position: fixed; bottom: 0; left: 50%; transform: translateX(-50%);
Â  Â  Â  Â  Â  Â  width: 100%; max-width: 600px;
Â  Â  Â  Â  Â  Â  height: calc(var(--nav-height) + var(--safe-area-bottom));
Â  Â  Â  Â  Â  Â  padding-bottom: var(--safe-area-bottom);
Â  Â  Â  Â  Â  Â  background: rgba(255,255,255,0.98); backdrop-filter: blur(10px);
Â  Â  Â  Â  Â  Â  border-top: 1px solid #eee;
Â  Â  Â  Â  Â  Â  display: flex; justify-content: space-around; align-items: center;
Â  Â  Â  Â  Â  Â  z-index: 900;
Â  Â  Â  Â  }
Â  Â  Â  Â  .nav-item {
Â  Â  Â  Â  Â  Â  flex: 1; text-align: center; color: #999; font-size: 10px;
Â  Â  Â  Â  Â  Â  cursor: pointer; padding-top: 5px; height: 100%;
Â  Â  Â  Â  Â  Â  display: flex; flex-direction: column; justify-content: start;
Â  Â  Â  Â  }
Â  Â  Â  Â  .nav-item .icon { font-size: 24px; display: block; margin-bottom: 2px; }
Â  Â  Â  Â  .nav-item.active { color: var(--primary); font-weight: bold; }
Â  Â  Â  Â  .nav-item.active .icon { transform: scale(1.1); transition: transform 0.2s; }

Â  Â  Â  Â  header { padding: 15px 0 5px; text-align: center; flex-shrink: 0;}
Â  Â  Â  Â  h1 { margin: 0; font-size: 20px; color: #2d3436; font-weight: 800; }

Â  Â  Â  Â  .card {
Â  Â  Â  Â  Â  Â  background: var(--card-bg); border-radius: 16px;
Â  Â  Â  Â  Â  Â  padding: 16px; margin-bottom: 16px;
Â  Â  Â  Â  Â  Â  box-shadow: 0 4px 15px rgba(0,0,0,0.03); border: 1px solid rgba(0,0,0,0.02);
Â  Â  Â  Â  Â  Â  position: relative;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  .card-title { font-size: 16px; font-weight: bold; margin: 0 0 12px 0; color: #333; display: flex; justify-content: space-between; align-items: center; flex-wrap: nowrap;}
Â  Â  Â  Â  .card-title span { white-space: nowrap; flex-shrink: 0; margin-right: 10px; }

Â  Â  Â  Â  /* ç­›é€‰æ  */
Â  Â  Â  Â  .chart-filter-bar {
Â  Â  Â  Â  Â  Â  background: #f8f9fa; padding: 10px; border-radius: 12px; margin-bottom: 15px;
Â  Â  Â  Â  Â  Â  display: flex; align-items: center; gap: 8px; border: 1px solid #eee;
Â  Â  Â  Â  Â  Â  overflow-x: auto; white-space: nowrap; -webkit-overflow-scrolling: touch;
Â  Â  Â  Â  }
Â  Â  Â  Â  .chart-filter-bar::-webkit-scrollbar { display: none; }
Â  Â  Â  Â  .date-picker-range {Â 
Â  Â  Â  Â  Â  Â  flex: 1; min-width: 110px; padding: 8px; border-radius: 8px;Â 
Â  Â  Â  Â  Â  Â  border: 1px solid #ddd; background: #fff; font-size: 13px;Â 
Â  Â  Â  Â  Â  Â  outline: none; -webkit-appearance: none; text-align: center;
Â  Â  Â  Â  }
Â  Â  Â  Â  .range-sep { color: #999; font-size: 12px; font-weight: bold; }

Â  Â  Â  Â  /* é¦–é¡µç»„ä»¶ */
Â  Â  Â  Â  .budget-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
Â  Â  Â  Â  .budget-top { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 14px; opacity: 0.9; }
Â  Â  Â  Â  .budget-main { font-size: 28px; font-weight: bold; margin-bottom: 10px; }
Â  Â  Â  Â  .budget-bar { background: rgba(255,255,255,0.3); height: 6px; border-radius: 3px; overflow: hidden; }
Â  Â  Â  Â  .budget-fill { background: #fff; height: 100%; width: 0%; border-radius: 3px; transition: width 0.5s; }
Â  Â  Â  Â  .budget-set-btn { background: rgba(255,255,255,0.2); border: none; color: white; padding: 4px 10px; border-radius: 12px; font-size: 12px; }

Â  Â  Â  Â  .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
Â  Â  Â  Â  .stat-box { background: #f8f9fa; padding: 12px; border-radius: 12px; text-align: center; }
Â  Â  Â  Â  .stat-label { font-size: 12px; color: #888; margin-bottom: 4px; }
Â  Â  Â  Â  .stat-val { font-size: 16px; font-weight: bold; }
Â  Â  Â  Â  .c-in { color: var(--success); } .c-out { color: var(--danger); }
Â  Â  Â  Â  .c-save { color: var(--primary); } .c-debt { color: var(--warning); }

Â  Â  Â  Â  .form-row { display: flex; gap: 10px; margin-bottom: 10px; }
Â  Â  Â  Â  .form-col { flex: 1; }
Â  Â  Â  Â  label { display: block; font-size: 12px; color: #666; margin-bottom: 4px; font-weight: 500;}
Â  Â  Â  Â  input, select {
Â  Â  Â  Â  Â  Â  width: 100%; padding: 10px; border: 1px solid #eee; background: #f9f9f9;
Â  Â  Â  Â  Â  Â  border-radius: 10px; font-size: 15px; outline: none; -webkit-appearance: none;
Â  Â  Â  Â  }
Â  Â  Â  Â  input:focus, select:focus { background: #fff; border-color: var(--primary); }
Â  Â  Â  Â  .btn-submit {
Â  Â  Â  Â  Â  Â  width: 100%; padding: 14px; border: none; border-radius: 12px;
Â  Â  Â  Â  Â  Â  background: var(--danger); color: white; font-size: 16px; font-weight: bold;
Â  Â  Â  Â  Â  Â  box-shadow: 0 4px 10px rgba(255, 118, 117, 0.4); cursor: pointer; transition: transform 0.1s;
Â  Â  Â  Â  }
Â  Â  Â  Â  .btn-submit:active { transform: scale(0.96); }

Â  Â  Â  Â  .chart-tabs { display: flex; gap: 5px; margin-bottom: 15px; overflow-x: auto; padding-bottom: 5px; -webkit-overflow-scrolling: touch;}
Â  Â  Â  Â  .chart-pill {
Â  Â  Â  Â  Â  Â  padding: 6px 16px; background: #eee; border-radius: 20px; font-size: 13px; color: #666; white-space: nowrap; cursor: pointer;
Â  Â  Â  Â  }
Â  Â  Â  Â  .chart-pill.active { background: var(--primary); color: white; }
Â  Â  Â  Â  .chart-container { position: relative; height: 300px; width: 100%; overflow: hidden; }
Â  Â  Â  Â  .chart-view {Â 
Â  Â  Â  Â  Â  Â  position: absolute; top: 0; left: 0; width: 100%; height: 100%;
Â  Â  Â  Â  Â  Â  background: var(--card-bg); opacity: 0; visibility: hidden; transition: opacity 0.3s; z-index: 0;
Â  Â  Â  Â  }
Â  Â  Â  Â  .chart-view.active { opacity: 1; visibility: visible; z-index: 1; }

Â  Â  Â  Â  .trans-list { list-style: none; padding: 0; margin: 0; }
Â  Â  Â  Â  .trans-item { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #f5f5f5; }
Â  Â  Â  Â  .t-left { display: flex; align-items: center; gap: 12px; }
Â  Â  Â  Â  .t-icon { width: 40px; height: 40px; background: #f4f6f8; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px; }
Â  Â  Â  Â  .t-info h4 { margin: 0; font-size: 15px; color: #333; }
Â  Â  Â  Â  .t-info span { font-size: 12px; color: #999; }
Â  Â  Â  Â  .t-amount { font-weight: bold; font-size: 16px; }
Â  Â  Â  Â  .del-btn { background: none; border: none; color: #ddd; font-size: 18px; padding: 0 0 0 10px;}

Â  Â  Â  Â  .setting-item { display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 1px solid #f0f0f0; }
Â  Â  Â  Â  .setting-label { font-size: 15px; font-weight: 500; }
Â  Â  Â  Â  .setting-action button { padding: 8px 15px; border-radius: 8px; border: none; font-size: 13px; font-weight: 600; }
Â  Â  Â  Â  .btn-backup { background: #e3f2fd; color: #2196f3; }
Â  Â  Â  Â  .btn-recover { background: #f3e5f5; color: #9c27b0; }
Â  Â  Â  Â  .btn-excel { background: #e8f5e9; color: #4caf50; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* === ğŸ“­ ç©ºçŠ¶æ€ === */
Â  Â  Â  Â  .chart-empty-state {
Â  Â  Â  Â  Â  Â  position: absolute; top: 0; left: 0; width: 100%; height: 100%;
Â  Â  Â  Â  Â  Â  display: flex; flex-direction: column; align-items: center; justify-content: center;
Â  Â  Â  Â  Â  Â  background: rgba(255,255,255,0.95); z-index: 10; color: #ccc;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  .list-empty-state { padding: 40px 0; text-align: center; color: #bbb; font-size: 14px; }
Â  Â  Â  Â  .empty-icon { font-size: 48px; margin-bottom: 10px; opacity: 0.6; }
Â  Â  Â  Â  .empty-text { font-size: 14px; }

Â  Â  Â  Â  /* === ğŸ¬ åŠ¨ç”»å±‚ (å±…ä¸­+æ”¾å¤§ç‰ˆ) === */
Â  Â  Â  Â  #anim-layer { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 11000; overflow: hidden; display: none;}
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* 1. è·‘åŠ¨åŠ¨ç”» (æ”¯å‡ºç±» - å±…ä¸­ä¸”æ”¾å¤§) */
Â  Â  Â  Â  .run-anim {Â 
Â  Â  Â  Â  Â  Â  position: absolute;Â 
Â  Â  Â  Â  Â  Â  top: 50%; /* å‚ç›´å±…ä¸­ */
Â  Â  Â  Â  Â  Â  right: -150px;Â 
Â  Â  Â  Â  Â  Â  transform: translateY(-50%); /* ä¿®æ­£å±…ä¸­åç§» */
Â  Â  Â  Â  Â  Â  animation: runAcross 2.5s linear forwards;Â 
Â  Â  Â  Â  Â  Â  display: flex; align-items: center;
Â  Â  Â  Â  Â  Â  font-size: 90px; /* æ”¾å¤§å›¾æ ‡ */
Â  Â  Â  Â  }
Â  Â  Â  Â  .bounce-body { animation: bounce 0.3s infinite alternate; position: relative; }
Â  Â  Â  Â  .money-tag { position: absolute; font-size: 40px; top: 0; left: 25px; z-index: 2; transform: rotate(-10deg); }
Â  Â  Â  Â Â 
Â  Â  Â  Â  @keyframes runAcross {Â 
Â  Â  Â  Â  Â  Â  0% { right: -150px; transform: translateY(-50%) translateX(0); }Â 
Â  Â  Â  Â  Â  Â  100% { right: 100%; transform: translateY(-50%) translateX(-100px); }Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  @keyframes bounce { from { transform: translateY(0); } to { transform: translateY(-10px); } }

Â  Â  Â  Â  /* 2. å¼¹è·³åŠ¨ç”» (æ”¶å…¥ç±» - å±…ä¸­ä¸”æ”¾å¤§) */
Â  Â  Â  Â  .pop-anim {Â 
Â  Â  Â  Â  Â  Â  position: absolute; left: 50%; top: 40%; transform: translate(-50%, -50%) scale(0);Â 
Â  Â  Â  Â  Â  Â  font-size: 100px; animation: popIn 1.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;Â 
Â  Â  Â  Â  Â  Â  text-align: center; white-space: nowrap;
Â  Â  Â  Â  }
Â  Â  Â  Â  .pop-text {Â 
Â  Â  Â  Â  Â  Â  display: block; font-size: 24px; color: #fdcb6e; margin-top: 15px;Â 
Â  Â  Â  Â  Â  Â  font-weight: bold; background: #fff; padding: 10px 25px;Â 
Â  Â  Â  Â  Â  Â  border-radius: 40px; box-shadow: 0 10px 30px rgba(0,0,0,0.15);
Â  Â  Â  Â  }
Â  Â  Â  Â  @keyframes popIn {Â 
Â  Â  Â  Â  Â  Â  0% { transform: translate(-50%, -50%) scale(0); opacity: 0;}Â 
Â  Â  Â  Â  Â  Â  50% { opacity: 1;}Â 
Â  Â  Â  Â  Â  Â  100% { transform: translate(-50%, -50%) scale(1.5); opacity: 0; }Â 
Â  Â  Â  Â  }

Â  Â  Â  Â  #toast { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.8); color: white; padding: 10px 25px; border-radius: 30px; font-size: 14px; z-index: 10004; opacity: 0; transition: opacity 0.3s; pointer-events: none; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
Â  Â  Â  Â  #toast.show { opacity: 1; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  #file-input { display: none; }
Â  Â  Â  Â  .cat-list { list-style: none; padding: 0; margin-top: 10px; border: 1px solid #eee; border-radius: 8px; max-height: 200px; overflow-y: auto;}
Â  Â  Â  Â  .cat-item { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid #eee; }
Â  Â  Â  Â  .list-filter-bar { display: flex; gap: 8px; margin-bottom: 10px; }
Â  Â  Â  Â  .list-filter-bar input { flex: 2; padding: 8px; font-size: 13px; border-radius: 8px; }
Â  Â  Â  Â  .list-filter-bar select { flex: 1; padding: 8px; font-size: 13px; border-radius: 8px; }

Â  Â  Â  Â  /* === ğŸ§­ èšå…‰ç¯æŒ‡å¼•ç³»ç»Ÿ === */
Â  Â  Â  Â  #spotlight-overlay {
Â  Â  Â  Â  Â  Â  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
Â  Â  Â  Â  Â  Â  pointer-events: none; z-index: 9990; display: none;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .spotlight-box {
Â  Â  Â  Â  Â  Â  position: absolute; border-radius: 12px;
Â  Â  Â  Â  Â  Â  transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
Â  Â  Â  Â  Â  Â  box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.75);
Â  Â  Â  Â  Â  Â  border: 2px solid rgba(255,255,255,0.8);
Â  Â  Â  Â  Â  Â  pointer-events: none;
Â  Â  Â  Â  }

Â  Â  Â  Â  .guide-tooltip {
Â  Â  Â  Â  Â  Â  position: absolute; width: 280px; background: #fff; padding: 20px;
Â  Â  Â  Â  Â  Â  border-radius: 16px; text-align: center;
Â  Â  Â  Â  Â  Â  box-shadow: 0 10px 40px rgba(0,0,0,0.5), 0 0 20px rgba(255,255,255,0.6);
Â  Â  Â  Â  Â  Â  z-index: 10002; opacity: 0;
Â  Â  Â  Â  Â  Â  transition: opacity 0.3s, transform 0.4s; pointer-events: auto;
Â  Â  Â  Â  }
Â  Â  Â  Â  .guide-tooltip.show { opacity: 1; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .guide-lion { font-size: 40px; position: absolute; top: -25px; left: 50%; transform: translateX(-50%); background:#fff; border-radius:50%; width:50px; height:50px; line-height:50px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
Â  Â  Â  Â  .guide-title { font-size: 16px; font-weight: bold; margin-top: 15px; margin-bottom: 8px; color: var(--primary); }
Â  Â  Â  Â  .guide-text { font-size: 14px; color: #666; margin-bottom: 15px; line-height: 1.5; }
Â  Â  Â  Â  .guide-btn-row { display: flex; gap: 10px; justify-content: center; }
Â  Â  Â  Â  .guide-btn { border: none; padding: 8px 20px; border-radius: 20px; font-size: 13px; font-weight: bold; cursor: pointer; }
Â  Â  Â  Â  .btn-skip { background: #f0f0f0; color: #999; }
Â  Â  Â  Â  .btn-next { background: var(--primary); color: white; }

Â  Â  Â  Â  .guide-highlight {
Â  Â  Â  Â  Â  Â  position: relative; z-index: 10000 !important;
Â  Â  Â  Â  Â  Â  box-shadow: 0 0 0 5px rgba(255, 255, 255, 0.6), 0 0 0 9999px rgba(0,0,0,0.75) !important;
Â  Â  Â  Â  Â  Â  transition: all 0.3s;
Â  Â  Â  Â  Â  Â  background-color: var(--card-bg);
Â  Â  Â  Â  }
Â  Â  </style>
</head>
<body>

<div id="app">
Â  Â  <header><h1>ğŸ¦ è´¢åŠ¡ç®¡å®¶</h1></header>

Â  Â  <div id="view-home" class="view-container active">
Â  Â  Â  Â  <div class="card budget-card" id="target-budget">
Â  Â  Â  Â  Â  Â  <div class="budget-top"><span>ğŸ“… æœ¬æœˆé¢„ç®—</span><button class="budget-set-btn" onclick="setBudget()">è®¾ç½®</button></div>
Â  Â  Â  Â  Â  Â  <div class="budget-main" id="budget-display">Â¥0.00</div>
Â  Â  Â  Â  Â  Â  <div class="budget-bar"><div class="budget-fill" id="budget-fill"></div></div>
Â  Â  Â  Â  Â  Â  <div style="margin-top:8px; font-size:12px; display:flex; justify-content:space-between;"><span id="budget-text">å·²ç”¨ 0%</span><span>å‰©ä½™: <strong id="budget-remaining">Â¥0.00</strong></span></div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="stats-grid">
Â  Â  Â  Â  Â  Â  <div class="stat-box"><div class="stat-label">æœ¬æœˆæ”¶å…¥</div><div class="stat-val c-in" id="month-income">Â¥0.00</div></div>
Â  Â  Â  Â  Â  Â  <div class="stat-box"><div class="stat-label">æœ¬æœˆæ”¯å‡º</div><div class="stat-val c-out" id="month-expense">Â¥0.00</div></div>
Â  Â  Â  Â  Â  Â  <div class="stat-box"><div class="stat-label">ç´¯è®¡å‚¨è“„</div><div class="stat-val c-save" id="total-savings">Â¥0.00</div></div>
Â  Â  Â  Â  Â  Â  <div class="stat-box"><div class="stat-label">å¾…æ”¶æ¬ æ¬¾</div><div class="stat-val c-debt" id="total-debt">Â¥0.00</div></div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="card" style="margin-top: 16px;" id="target-form">
Â  Â  Â  Â  Â  Â  <div class="card-title">âœï¸ å¿«é€Ÿè®°è´¦</div>
Â  Â  Â  Â  Â  Â  <form id="transaction-form">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-row"><div class="form-col"><label>æ—¥æœŸ</label><input type="date" id="date" required /></div><div class="form-col"><label>é‡‘é¢</label><input type="number" id="amount" placeholder="0.00" step="0.01" required inputmode="decimal"/></div></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-row">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-col"><label>ç±»å‹</label><select id="type" onchange="updateCategoryOptions()"><option value="expense">æ”¯å‡º (-)</option><option value="income">æ”¶å…¥ (+)</option><option value="savings_in">å­˜å…¥å‚¨è“„</option><option value="savings_out">å–å‡ºå‚¨è“„</option><option value="debt_out">å€Ÿå‡ºå€ºæƒ</option><option value="debt_in">æ”¶å›å€ºæƒ</option></select></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-col"><label>åˆ†ç±»</label><select id="category"></select></div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-control" style="margin-bottom: 15px;"><label>å¤‡æ³¨ (é€‰å¡«)</label><input type="text" id="text" placeholder="ä¾‹å¦‚ï¼šæ—©é¤ã€æ‰“è½¦..." /></div>
Â  Â  Â  Â  Â  Â  Â  Â  <button type="submit" id="btn-submit" class="btn-submit">è®°ä¸€ç¬”</button>
Â  Â  Â  Â  Â  Â  </form>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="card">
Â  Â  Â  Â  Â  Â  <div class="card-title">ğŸ•’ æœ€è¿‘è®°å½•</div>
Â  Â  Â  Â  Â  Â  <ul id="recent-list" class="trans-list"></ul>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="view-charts" class="view-container">
Â  Â  Â  Â  <div class="card">
Â  Â  Â  Â  Â  Â  <div class="card-title"><span>ğŸ“Š æ•°æ®åˆ†æ</span></div>
Â  Â  Â  Â  Â  Â  <div class="chart-filter-bar">
Â  Â  Â  Â  Â  Â  Â  Â  <span style="font-size:12px;color:#666;">ğŸ“…</span>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="date" id="start-date" class="date-picker-range" onchange="renderChartsPage()">
Â  Â  Â  Â  Â  Â  Â  Â  <span class="range-sep">è‡³</span>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="date" id="end-date" class="date-picker-range" onchange="renderChartsPage()">
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div id="target-chart">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="chart-tabs">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="chart-pill active" onclick="switchChart('expense')">æ”¯å‡º</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="chart-pill" onclick="switchChart('income')">æ”¶å…¥</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="chart-pill" onclick="switchChart('savings')">å‚¨è“„</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="chart-pill" onclick="switchChart('debt')">å€ºæƒ</div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="chart-container">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="chart-empty-state" class="chart-empty-state" style="display:none;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="empty-icon">ğŸ“‰</div><div class="empty-text">æš‚æ— æ•°æ®ï¼Œç‹®å­åœ¨æ‰“ç›¹</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="chart-view-expense" class="chart-view active"><canvas id="expenseChart"></canvas></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="chart-view-income" class="chart-view"><canvas id="incomeChart"></canvas></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="chart-view-savings" class="chart-view"><canvas id="savingsChart"></canvas></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="chart-view-debt" class="chart-view"><canvas id="debtChart"></canvas></div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="card">
Â  Â  Â  Â  Â  Â  <div class="card-title">ğŸ“œ ç­›é€‰æ˜ç»†</div>
Â  Â  Â  Â  Â  Â  <div class="form-row">
Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="search-input" placeholder="ğŸ” æœå¤‡æ³¨/åˆ†ç±»..." oninput="renderFullList()">
Â  Â  Â  Â  Â  Â  Â  Â  <select id="filter-select" style="width: 100px;" onchange="renderFullList()"><option value="all">å…¨éƒ¨</option><option value="expense">æ”¯å‡º</option><option value="income">æ”¶å…¥</option><option value="debt">å€ºæƒ</option></select>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <ul id="full-list" class="trans-list"></ul>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="view-settings" class="view-container">
Â  Â  Â  Â  <div class="card" id="target-backup">
Â  Â  Â  Â  Â  Â  <div class="card-title">âš™ï¸ æ•°æ®ç®¡ç†</div>
Â  Â  Â  Â  Â  Â  <div class="setting-item"><div class="setting-label">å¯¼å‡º Excel è¡¨æ ¼</div><div class="setting-action"><button class="btn-excel" onclick="exportToExcel()">å¯¼å‡º csv</button></div></div>
Â  Â  Â  Â  Â  Â  <div class="setting-item"><div class="setting-label">å¤‡ä»½æ•°æ®æ–‡ä»¶</div><div class="setting-action"><button class="btn-backup" onclick="exportData(true)">ä¸‹è½½å¤‡ä»½</button></div></div>
Â  Â  Â  Â  Â  Â  <div class="setting-item"><div class="setting-label">æ¢å¤æ•°æ®</div><div class="setting-action"><button class="btn-recover" onclick="document.getElementById('file-input').click()">å¯¼å…¥æ–‡ä»¶</button><input type="file" id="file-input" accept=".json" onchange="importData(this)"></div></div>
Â  Â  Â  Â  Â  Â  <div class="setting-item"><div class="setting-label">æ–°æ‰‹å¼•å¯¼</div><div class="setting-action"><button class="btn-backup" onclick="forceGuide()">é‡çœ‹æŒ‡å¼•</button></div></div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="card">
Â  Â  Â  Â  Â  Â  <div class="card-title">ğŸ·ï¸ åˆ†ç±»ç®¡ç†</div>
Â  Â  Â  Â  Â  Â  <div class="form-row">
Â  Â  Â  Â  Â  Â  Â  Â  <select id="manage-type-select" onchange="renderManageList()"><option value="expense">æ”¯å‡º</option><option value="income">æ”¶å…¥</option><option value="savings_in">å­˜å…¥</option><option value="debt_out">å€Ÿå‡º</option></select>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <ul id="manage-list" class="cat-list"></ul>
Â  Â  Â  Â  Â  Â  <div class="form-row" style="margin-top:10px; align-items: center;">
Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="new-cat-icon" placeholder="Emoji" style="width:60px; text-align:center;">
Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="new-cat-name" placeholder="æ–°åˆ†ç±»å">
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="addNewCategory()" style="width:60px; margin:0; padding:10px; background:var(--success); color:white; border:none; border-radius:8px;">+</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div class="bottom-nav" id="target-nav">
Â  Â  Â  Â  <div class="nav-item active" onclick="switchView('home')"><span class="icon">ğŸ </span>é¦–é¡µ</div>
Â  Â  Â  Â  <div class="nav-item" onclick="switchView('charts')"><span class="icon">ğŸ“Š</span>å›¾è¡¨</div>
Â  Â  Â  Â  <div class="nav-item" onclick="switchView('settings')"><span class="icon">âš™ï¸</span>è®¾ç½®</div>
Â  Â  </div>
</div>

<div id="anim-layer"></div>
<div id="toast"></div>

<div id="spotlight-overlay">
Â  Â  <div class="spotlight-box" id="spotlight-box"></div>
Â  Â  <div class="guide-tooltip" id="guide-tooltip">
Â  Â  Â  Â  <div class="guide-lion">ğŸ¦</div>
Â  Â  Â  Â  <div class="guide-title" id="guide-title">Title</div>
Â  Â  Â  Â  <div class="guide-text" id="guide-text">Text</div>
Â  Â  Â  Â  <div class="guide-btn-row">
Â  Â  Â  Â  Â  Â  <button class="guide-btn btn-skip" onclick="endGuide()">è·³è¿‡</button>
Â  Â  Â  Â  Â  Â  <button class="guide-btn btn-next" onclick="nextGuide()">ä¸‹ä¸€æ­¥</button>
Â  Â  Â  Â  </div>
Â  Â  </div>
</div>

<script>
Â  Â  function switchView(viewName) {
Â  Â  Â  Â  document.querySelectorAll('.view-container').forEach(el => el.classList.remove('active'));
Â  Â  Â  Â  document.getElementById(`view-${viewName}`).classList.add('active');
Â  Â  Â  Â  document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
Â  Â  Â  Â  const index = viewName === 'home' ? 0 : viewName === 'charts' ? 1 : 2;
Â  Â  Â  Â  document.querySelectorAll('.nav-item')[index].classList.add('active');
Â  Â  Â  Â  if(viewName === 'charts') renderChartsPage();Â 
Â  Â  }

Â  Â  const defaultCategories = {
Â  Â  Â  Â  expense: [{name:'é¤é¥®',icon:'ğŸ”'},{name:'è´­ç‰©',icon:'ğŸ›’'},{name:'äº¤é€š',icon:'ğŸš—'},{name:'æˆ¿ç§Ÿ',icon:'ğŸ '},{name:'å¨±ä¹',icon:'ğŸ®'}],
Â  Â  Â  Â  income: [{name:'å·¥èµ„',icon:'ğŸ’°'},{name:'å…¼èŒ',icon:'âš¡'},{name:'ç†è´¢',icon:'ğŸ“ˆ'}],
Â  Â  Â  Â  savings_in: [{name:'å­˜é’±',icon:'ğŸ¦'},{name:'åŸºé‡‘',icon:'ğŸ“Š'}],
Â  Â  Â  Â  savings_out: [{name:'å–æ¬¾',icon:'ğŸ§'}],
Â  Â  Â  Â  debt_out: [{name:'å€Ÿå‡º',icon:'ğŸ¤'},{name:'å«ä»˜',icon:'ğŸ“'}],
Â  Â  Â  Â  debt_in: [{name:'è¿˜æ¬¾',icon:'ğŸ“¥'}]
Â  Â  };

Â  Â  let categoryData = JSON.parse(localStorage.getItem('categoryData')) || defaultCategories;
Â  Â  let transactions = JSON.parse(localStorage.getItem('transactions')) || [];
Â  Â  let currentBudget = parseFloat(localStorage.getItem('monthlyBudget')) || 0;

Â  Â  // === ğŸ¦ èšå…‰ç¯æŒ‡å¼•é€»è¾‘ ===
Â  Â  let guideStep = 0;
Â  Â  const guideData = [
Â  Â  Â  Â  { id: 'start', title: "æ¬¢è¿æ–°æœ‹å‹ï¼", text: "æˆ‘æ˜¯ä½ çš„è´¢åŠ¡å°ç‹®å­ã€‚\nèŠ± 1 åˆ†é’Ÿå¸¦ä½ ç†Ÿæ‚‰ä¸€ä¸‹æ–°å®¶å§ï¼", target: null },
Â  Â  Â  Â  { id: 'budget', title: "ğŸ’° è®¾ç½®é¢„ç®—", text: "ç‚¹å‡»è¿™é‡Œè®¾ç½®æœ¬æœˆé¢„ç®—ã€‚\nå¿«èŠ±è¶…çš„æ—¶å€™æˆ‘ä¼šæé†’ä½ å“¦ï¼", target: 'target-budget' },
Â  Â  Â  Â  { id: 'form', title: "âœï¸ æé€Ÿè®°è´¦", text: "æ—¥æœŸã€é‡‘é¢ã€åˆ†ç±»ï¼Œä¸€å±æå®šï¼\né‡‘é¢ä¸èƒ½ä¸º0ï¼Œä½ å¯ä»¥ã€ç›´æ¥æ“ä½œã€‘ï¼Œè®°å®Œä¸€ç¬”æˆ‘ä¼šè‡ªåŠ¨å¸¦ä½ ç»§ç»­ï¼", target: 'target-form' },
Â  Â  Â  Â  { id: 'chart', title: "ğŸ“Š å›¾è¡¨åˆ†æ", text: "è‡ªåŠ¨ç”Ÿæˆæ”¶æ”¯é¥¼å›¾ï¼Œ\næ”¯æŒé€‰æ‹©ä»»æ„æ—¶é—´èŒƒå›´ï¼", target: 'target-chart' },
Â  Â  Â  Â  { id: 'backup', title: "ğŸ’¾ æ•°æ®é˜²ä¸¢", text: "é‡è¦ï¼è¿™æ˜¯å•æœºç½‘é¡µç‰ˆã€‚\næ¸…ç¼“å­˜æˆ–æ¢æ‰‹æœºå‰ï¼ŒåŠ¡å¿…ç‚¹ã€ä¸‹è½½å¤‡ä»½ã€‘ï¼", target: 'target-backup' },
Â  Â  Â  Â  { id: 'nav', title: "ğŸ§­ éšæ—¶åˆ‡æ¢", text: "åº•éƒ¨å¯¼èˆªæ éšæ—¶åˆ‡æ¢é¡µé¢ã€‚\nå¥½äº†ï¼Œå¼€å§‹ä½ çš„è´¢å¯Œè‡ªç”±ä¹‹æ—…å§ï¼ğŸš€", target: 'target-nav' }
Â  Â  ];

Â  Â  function checkGuide() {
Â  Â  Â  Â  if (!localStorage.getItem('hasSeenGuide')) setTimeout(startGuide, 500);
Â  Â  }
Â  Â Â 
Â  Â  function forceGuide() {
Â  Â  Â  Â  localStorage.removeItem('hasSeenGuide');
Â  Â  Â  Â  location.reload();
Â  Â  }

Â  Â  function startGuide() {
Â  Â  Â  Â  document.getElementById('spotlight-overlay').style.display = 'block';
Â  Â  Â  Â  guideStep = 0;
Â  Â  Â  Â  renderGuideStep(guideStep);
Â  Â  }

Â  Â  function endGuide() {
Â  Â  Â  Â  document.getElementById('spotlight-overlay').style.display = 'none';
Â  Â  Â  Â  localStorage.setItem('hasSeenGuide', 'true');
Â  Â  Â  Â  switchView('home');
Â  Â  }

Â  Â  function nextGuide() {
Â  Â  Â  Â  guideStep++;
Â  Â  Â  Â  if (guideStep >= guideData.length) {
Â  Â  Â  Â  Â  Â  endGuide();
Â  Â  Â  Â  Â  Â  playAnim('guide_success');
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  renderGuideStep(guideStep);
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function renderGuideStep(index) {
Â  Â  Â  Â  const step = guideData[index];
Â  Â  Â  Â  const spotBox = document.getElementById('spotlight-box');
Â  Â  Â  Â  const tooltip = document.getElementById('guide-tooltip');
Â  Â  Â  Â Â 
Â  Â  Â  Â  document.getElementById('guide-title').innerText = step.title;
Â  Â  Â  Â  document.getElementById('guide-text').innerText = step.text;

Â  Â  Â  Â  if (step.id === 'chart') switchView('charts');
Â  Â  Â  Â  if (step.id === 'backup') switchView('settings');

Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  if (step.target) {
Â  Â  Â  Â  Â  Â  Â  Â  const targetEl = document.getElementById(step.target);
Â  Â  Â  Â  Â  Â  Â  Â  if(targetEl) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const rect = targetEl.getBoundingClientRect();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  spotBox.style.width = rect.width + 'px';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  spotBox.style.height = rect.height + 'px';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  spotBox.style.top = rect.top + 'px';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  spotBox.style.left = rect.left + 'px';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  spotBox.style.borderRadius = getComputedStyle(targetEl).borderRadius;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  spotBox.style.opacity = 1;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const screenH = window.innerHeight;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const spaceBelow = screenH - rect.bottom;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let toolTop = '50%'; let toolTransform = 'translate(-50%, -50%)';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (spaceBelow > 200) { toolTop = (rect.bottom + 20) + 'px'; toolTransform = 'translateX(-50%)'; }Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else if (rect.top > 200) { toolTop = (rect.top - 200) + 'px'; toolTransform = 'translateX(-50%)'; }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tooltip.style.top = toolTop;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tooltip.style.left = '50%';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tooltip.style.transform = toolTransform;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tooltip.classList.add('show');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  spotBox.style.opacity = 0; spotBox.style.top = '-1000px';Â 
Â  Â  Â  Â  Â  Â  Â  Â  tooltip.style.top = '50%'; tooltip.style.left = '50%';
Â  Â  Â  Â  Â  Â  Â  Â  tooltip.style.transform = 'translate(-50%, -50%)';
Â  Â  Â  Â  Â  Â  Â  Â  tooltip.classList.add('show');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }, 150);
Â  Â  }

Â  Â  // === ğŸ¬ éŸ³æ•ˆæ§åˆ¶å™¨ (Web Audio API) ===
Â  Â  const AudioContext = window.AudioContext || window.webkitAudioContext;
Â  Â  const audioCtx = new AudioContext();

Â  Â  function playSound(type) {
Â  Â  Â  Â  if (audioCtx.state === 'suspended') audioCtx.resume();
Â  Â  Â  Â  const osc = audioCtx.createOscillator();
Â  Â  Â  Â  const gain = audioCtx.createGain();
Â  Â  Â  Â  osc.connect(gain);
Â  Â  Â  Â  gain.connect(audioCtx.destination);

Â  Â  Â  Â  const now = audioCtx.currentTime;
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (type === 'coin') { // å®ï¼
Â  Â  Â  Â  Â  Â  osc.type = 'sine';
Â  Â  Â  Â  Â  Â  osc.frequency.setValueAtTime(1200, now);
Â  Â  Â  Â  Â  Â  osc.frequency.exponentialRampToValueAtTime(2000, now + 0.1);
Â  Â  Â  Â  Â  Â  gain.gain.setValueAtTime(0.3, now);
Â  Â  Â  Â  Â  Â  gain.gain.exponentialRampToValueAtTime(0.01, now + 0.5);
Â  Â  Â  Â  Â  Â  osc.start(now); osc.stop(now + 0.5);
Â  Â  Â  Â  }Â 
Â  Â  Â  Â  else if (type === 'swoosh') { // å’»~
Â  Â  Â  Â  Â  Â  osc.type = 'triangle';
Â  Â  Â  Â  Â  Â  osc.frequency.setValueAtTime(800, now);
Â  Â  Â  Â  Â  Â  osc.frequency.exponentialRampToValueAtTime(100, now + 0.3);
Â  Â  Â  Â  Â  Â  gain.gain.setValueAtTime(0.2, now);
Â  Â  Â  Â  Â  Â  gain.gain.linearRampToValueAtTime(0.01, now + 0.3);
Â  Â  Â  Â  Â  Â  osc.start(now); osc.stop(now + 0.3);
Â  Â  Â  Â  }
Â  Â  Â  Â  else if (type === 'pop') { // å•µ
Â  Â  Â  Â  Â  Â  osc.type = 'sine';
Â  Â  Â  Â  Â  Â  osc.frequency.setValueAtTime(400, now);
Â  Â  Â  Â  Â  Â  osc.frequency.exponentialRampToValueAtTime(600, now + 0.1);
Â  Â  Â  Â  Â  Â  gain.gain.setValueAtTime(0.2, now);
Â  Â  Â  Â  Â  Â  gain.gain.exponentialRampToValueAtTime(0.01, now + 0.15);
Â  Â  Â  Â  Â  Â  osc.start(now); osc.stop(now + 0.15);
Â  Â  Â  Â  }
Â  Â  }

Â  Â  // === ğŸ¬ æ ¸å¿ƒåŠ¨ç”»é€»è¾‘ (å…¨ç±»å‹è¦†ç›–) ===
Â  Â  function playAnim(type) {
Â  Â  Â  Â  const layer = document.getElementById('anim-layer');
Â  Â  Â  Â  layer.style.display = 'block'; layer.innerHTML = '';
Â  Â  Â  Â Â 
Â  Â  Â  Â  // 1. å¼¹è·³ç±» (å¼€å¿ƒ)
Â  Â  Â  Â  if(['income', 'savings_in', 'debt_in', 'guide_success'].includes(type)) {
Â  Â  Â  Â  Â  Â  playSound('coin');
Â  Â  Â  Â  Â  Â  let emoji = 'ğŸ˜º', text = 'æ”¶å…¥åˆ°è´¦!';
Â  Â  Â  Â  Â  Â  if(type === 'savings_in') { emoji = 'ğŸ·'; text = 'å­˜é’±æˆåŠŸ!'; }
Â  Â  Â  Â  Â  Â  if(type === 'debt_in') { emoji = 'ğŸ’'; text = 'æ”¶å›æ¬ æ¬¾!'; }
Â  Â  Â  Â  Â  Â  if(type === 'guide_success') { emoji = 'ğŸ‰'; text = 'ç¥ä½ è®°è´¦æ„‰å¿«!'; }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  layer.innerHTML = `<div class="pop-anim">${emoji}<span class="pop-text">${text}</span></div>`;
Â  Â  Â  Â  Â  Â  setTimeout(() => { layer.style.display = 'none'; }, 2000);
Â  Â  Â  Â  }Â 
Â  Â  Â  Â  // 2. è·‘åŠ¨ç±» (æºœèµ°)
Â  Â  Â  Â  else if(['expense', 'savings_out', 'debt_out'].includes(type)) {
Â  Â  Â  Â  Â  Â  playSound('swoosh');
Â  Â  Â  Â  Â  Â  let emoji = 'ğŸ­', tag = 'ğŸ’°';
Â  Â  Â  Â  Â  Â  if(type === 'savings_out') { emoji = 'ğŸ’¸'; tag = ''; } // é’±é£èµ°äº†
Â  Â  Â  Â  Â  Â  if(type === 'debt_out') { emoji = 'ğŸ¤'; tag = 'ğŸ“¤'; } // æ¡æ‰‹å€Ÿå‡º
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  layer.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="run-anim">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="bounce-body">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>${emoji}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${tag ? `<span class="money-tag">${tag}</span>` : ''}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>`;
Â  Â  Â  Â  Â  Â  setTimeout(() => { layer.style.display = 'none'; }, 2500);
Â  Â  Â  Â  }
Â  Â  }

Â  Â  let toastTimer;
Â  Â  function showToast(msg) {
Â  Â  Â  Â  const t = document.getElementById('toast');
Â  Â  Â  Â  t.innerText = msg; t.classList.add('show');
Â  Â  Â  Â  clearTimeout(toastTimer);
Â  Â  Â  Â  toastTimer = setTimeout(() => t.classList.remove('show'), 2000);
Â  Â  }

Â  Â  function setBudget() {
Â  Â  Â  Â  const val = prompt("è¯·è¾“å…¥æœ¬æœˆé¢„ç®—é‡‘é¢ï¼š", currentBudget);
Â  Â  Â  Â  if(val !== null) {
Â  Â  Â  Â  Â  Â  playSound('pop');
Â  Â  Â  Â  Â  Â  currentBudget = parseFloat(val) || 0;
Â  Â  Â  Â  Â  Â  localStorage.setItem('monthlyBudget', currentBudget);
Â  Â  Â  Â  Â  Â  updateHomeStats();
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function updateCategoryOptions() {
Â  Â  Â  Â  const type = document.getElementById('type').value;
Â  Â  Â  Â  const select = document.getElementById('category');
Â  Â  Â  Â  select.innerHTML = '';
Â  Â  Â  Â  (categoryData[type] || []).forEach(c => {
Â  Â  Â  Â  Â  Â  const opt = document.createElement('option');
Â  Â  Â  Â  Â  Â  opt.value = c.name; opt.innerHTML = `${c.icon} ${c.name}`; opt.dataset.icon = c.icon;
Â  Â  Â  Â  Â  Â  select.appendChild(opt);
Â  Â  Â  Â  });
Â  Â  Â  Â  const btn = document.getElementById('btn-submit');
Â  Â  Â  Â  if(type==='expense') { btn.style.background = 'var(--danger)'; btn.innerText = 'ğŸ’¸ ç¡®è®¤æ”¯å‡º'; }
Â  Â  Â  Â  else if(type==='income') { btn.style.background = 'var(--success)'; btn.innerText = 'ğŸ’° ç¡®è®¤æ”¶å…¥'; }
Â  Â  Â  Â  else { btn.style.background = 'var(--primary)'; btn.innerText = 'âœ¨ æäº¤è®°å½•'; }
Â  Â  }

Â  Â  document.getElementById('transaction-form').addEventListener('submit', function(e) {
Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  const amtInput = document.getElementById('amount');
Â  Â  Â  Â  if (!amtInput.value || parseFloat(amtInput.value) === 0) { showToast("âš ï¸ é‡‘é¢ä¸èƒ½ä¸º 0"); return; }

Â  Â  Â  Â  const typeSelect = document.getElementById('type');
Â  Â  Â  Â  const catSelect = document.getElementById('category');
Â  Â  Â  Â  const t = {
Â  Â  Â  Â  Â  Â  id: Date.now(), date: document.getElementById('date').value,
Â  Â  Â  Â  Â  Â  amount: parseFloat(amtInput.value),
Â  Â  Â  Â  Â  Â  type: typeSelect.value, category: catSelect.value,
Â  Â  Â  Â  Â  Â  icon: catSelect.options[catSelect.selectedIndex]?.dataset.icon || 'ğŸ“',
Â  Â  Â  Â  Â  Â  text: document.getElementById('text').value || catSelect.value
Â  Â  Â  Â  };
Â  Â  Â  Â  transactions.push(t);
Â  Â  Â  Â  localStorage.setItem('transactions', JSON.stringify(transactions));
Â  Â  Â  Â Â 
Â  Â  Â  Â  playAnim(t.type); // è§¦å‘åŠ¨æ•ˆ+éŸ³æ•ˆ
Â  Â  Â  Â Â 
Â  Â  Â  Â  amtInput.value = ''; document.getElementById('text').value = '';
Â  Â  Â  Â  document.activeElement.blur();Â 
Â  Â  Â  Â  updateHomeStats();

Â  Â  Â  Â  if(document.getElementById('spotlight-overlay').style.display !== 'none' && guideStep === 2) {
Â  Â  Â  Â  Â  Â  setTimeout(() => nextGuide(), 1000);
Â  Â  Â  Â  }
Â  Â  });

Â  Â  function getEmptyHTML(text) {
Â  Â  Â  Â  return `<div class="list-empty-state"><div style="font-size:30px;margin-bottom:5px;">ğŸ“</div>${text}</div>`;
Â  Â  }

Â  Â  function getListItemHTML(t) {
Â  Â  Â  Â  let colorClass = '#333'; let sign = '';
Â  Â  Â  Â  if(t.type === 'income') { colorClass = 'var(--success)'; sign='+'; }
Â  Â  Â  Â  else if(t.type === 'expense') { colorClass = 'var(--danger)'; sign='-'; }
Â  Â  Â  Â  else if(t.type.startsWith('debt')) { colorClass = 'var(--warning)'; }
Â  Â  Â  Â  return `<li class="trans-item"><div class="t-left"><div class="t-icon">${t.icon}</div><div class="t-info"><h4>${t.text}</h4><span>${t.date} Â· ${t.category}</span></div></div><div class="t-left"><span class="t-amount" style="color:${colorClass}">${sign}Â¥${t.amount.toFixed(2)}</span><button class="del-btn" onclick="delItem(${t.id})">Ã—</button></div></li>`;
Â  Â  }

Â  Â  function updateHomeStats() {
Â  Â  Â  Â  transactions.sort((a,b) => new Date(b.date) - new Date(a.date) || b.id - a.id);
Â  Â  Â  Â  let income=0, expense=0, savings=0, debt=0;
Â  Â  Â  Â  const now = new Date();
Â  Â  Â  Â  const curM = now.getMonth(); const curY = now.getFullYear();
Â  Â  Â  Â  transactions.forEach(t => {
Â  Â  Â  Â  Â  Â  const d = new Date(t.date);
Â  Â  Â  Â  Â  Â  const isCurMonth = d.getMonth() === curM && d.getFullYear() === curY;
Â  Â  Â  Â  Â  Â  if(t.type === 'income' && isCurMonth) income += t.amount;
Â  Â  Â  Â  Â  Â  if(t.type === 'expense' && isCurMonth) expense += t.amount;
Â  Â  Â  Â  Â  Â  if(t.type === 'savings_in') savings += t.amount;
Â  Â  Â  Â  Â  Â  if(t.type === 'savings_out') savings -= t.amount;
Â  Â  Â  Â  Â  Â  if(t.type === 'debt_out') debt += t.amount;
Â  Â  Â  Â  Â  Â  if(t.type === 'debt_in') debt -= t.amount;
Â  Â  Â  Â  });
Â  Â  Â  Â  document.getElementById('month-income').innerText = `Â¥${income.toFixed(2)}`;
Â  Â  Â  Â  document.getElementById('month-expense').innerText = `Â¥${expense.toFixed(2)}`;
Â  Â  Â  Â  document.getElementById('total-savings').innerText = `Â¥${savings.toFixed(2)}`;
Â  Â  Â  Â  document.getElementById('total-debt').innerText = `Â¥${debt.toFixed(2)}`;
Â  Â  Â  Â  document.getElementById('budget-display').innerText = `Â¥${currentBudget.toFixed(2)}`;
Â  Â  Â  Â  const pct = currentBudget > 0 ? (expense / currentBudget) * 100 : 0;
Â  Â  Â  Â  document.getElementById('budget-fill').style.width = Math.min(pct, 100) + '%';
Â  Â  Â  Â  document.getElementById('budget-fill').style.background = pct > 100 ? 'var(--danger)' : 'var(--success)';
Â  Â  Â  Â  document.getElementById('budget-text').innerText = `å·²ç”¨ ${pct.toFixed(0)}%`;
Â  Â  Â  Â  document.getElementById('budget-remaining').innerText = `Â¥${(currentBudget - expense).toFixed(2)}`;
Â  Â  Â  Â Â 
Â  Â  Â  Â  const recentList = document.getElementById('recent-list');
Â  Â  Â  Â  if (transactions.length === 0) recentList.innerHTML = getEmptyHTML("æš‚æ— è®°å½•ï¼Œå¿«å»è®°ä¸€ç¬”~");
Â  Â  Â  Â  else recentList.innerHTML = transactions.slice(0, 5).map(getListItemHTML).join('');
Â  Â  }

Â  Â  window.delItem = function(id) {
Â  Â  Â  Â  if(confirm("åˆ é™¤è¿™æ¡è®°å½•ï¼Ÿ")) {
Â  Â  Â  Â  Â  Â  transactions = transactions.filter(t => t.id !== id);
Â  Â  Â  Â  Â  Â  localStorage.setItem('transactions', JSON.stringify(transactions));
Â  Â  Â  Â  Â  Â  updateHomeStats(); renderChartsPage(); showToast("ğŸ—‘ï¸ å·²åˆ é™¤");
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function getFilteredData() {
Â  Â  Â  Â  const s = document.getElementById('start-date').value;
Â  Â  Â  Â  const e = document.getElementById('end-date').value;
Â  Â  Â  Â  if(!s || !e) return transactions;
Â  Â  Â  Â  const start = new Date(s);
Â  Â  Â  Â  const end = new Date(e);
Â  Â  Â  Â  return transactions.filter(t => {
Â  Â  Â  Â  Â  Â  const d = new Date(t.date);
Â  Â  Â  Â  Â  Â  return d >= start && d <= end;
Â  Â  Â  Â  });
Â  Â  }

Â  Â  function renderChartsPage() {
Â  Â  Â  Â  renderFullList();
Â  Â  Â  Â  updateAllCharts();
Â  Â  }

Â  Â  function renderFullList() {
Â  Â  Â  Â  const keyword = document.getElementById('search-input').value.toLowerCase();
Â  Â  Â  Â  const typeFilter = document.getElementById('filter-select').value;
Â  Â  Â  Â  const listEl = document.getElementById('full-list');
Â  Â  Â  Â  const data = getFilteredData();Â 
Â  Â  Â  Â  const filtered = data.filter(t => {
Â  Â  Â  Â  Â  Â  const matchKey = t.text.toLowerCase().includes(keyword) || t.category.includes(keyword);
Â  Â  Â  Â  Â  Â  let matchType = true;
Â  Â  Â  Â  Â  Â  if(typeFilter === 'expense') matchType = t.type === 'expense';
Â  Â  Â  Â  Â  Â  if(typeFilter === 'income') matchType = t.type === 'income';
Â  Â  Â  Â  Â  Â  if(typeFilter === 'debt') matchType = t.type.startsWith('debt');
Â  Â  Â  Â  Â  Â  return matchKey && matchType;
Â  Â  Â  Â  });
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (filtered.length === 0) listEl.innerHTML = getEmptyHTML("ğŸ” æ‰¾ä¸åˆ°ç›¸å…³è®°å½•");
Â  Â  Â  Â  else listEl.innerHTML = filtered.map(getListItemHTML).join('');
Â  Â  }

Â  Â  let myCharts = {};
Â  Â  function switchChart(type) {
Â  Â  Â  Â  document.querySelectorAll('.chart-pill').forEach(el => el.classList.remove('active'));
Â  Â  Â  Â  event.target.classList.add('active');
Â  Â  Â  Â  document.querySelectorAll('.chart-view').forEach(el => { el.style.visibility='hidden'; el.style.zIndex=0; el.classList.remove('active'); });
Â  Â  Â  Â  const target = document.getElementById(`chart-view-${type}`);
Â  Â  Â  Â  target.style.visibility='visible'; target.style.zIndex=1; target.classList.add('active');
Â  Â  }

Â  Â  function updateAllCharts() {
Â  Â  Â  Â  const data = getFilteredData();
Â  Â  Â  Â  const emptyState = document.getElementById('chart-empty-state');
Â  Â  Â  Â  if (data.length === 0) {
Â  Â  Â  Â  Â  Â  emptyState.style.display = 'flex';
Â  Â  Â  Â  Â  Â  document.querySelectorAll('canvas').forEach(c => c.style.display = 'none');
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  emptyState.style.display = 'none';
Â  Â  Â  Â  Â  Â  document.querySelectorAll('canvas').forEach(c => c.style.display = 'block');
Â  Â  Â  Â  }

Â  Â  Â  Â  renderChart('expense', 'expense', data);Â 
Â  Â  Â  Â  renderChart('income', 'income', data);
Â  Â  Â  Â  renderChart('savings', 'savings_in', data);Â 
Â  Â  Â  Â  renderChart('debt', 'debt_out', data);
Â  Â  }

Â  Â  function renderChart(canvasId, typeKey, sourceData) {
Â  Â  Â  Â  const ctx = document.getElementById(canvasId + 'Chart').getContext('2d');
Â  Â  Â  Â  const dataMap = {};
Â  Â  Â  Â  sourceData.filter(t => t.type === typeKey).forEach(t => { dataMap[t.category] = (dataMap[t.category] || 0) + t.amount; });
Â  Â  Â  Â  if(myCharts[canvasId]) myCharts[canvasId].destroy();
Â  Â  Â  Â  myCharts[canvasId] = new Chart(ctx, {
Â  Â  Â  Â  Â  Â  type: 'doughnut',
Â  Â  Â  Â  Â  Â  data: {
Â  Â  Â  Â  Â  Â  Â  Â  labels: Object.keys(dataMap),
Â  Â  Â  Â  Â  Â  Â  Â  datasets: [{ data: Object.values(dataMap), backgroundColor: ['#4e54c8','#ff7675','#00b894','#fdcb6e','#6c5ce7','#d63031'], borderWidth: 0 }]
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'right' } } }
Â  Â  Â  Â  });
Â  Â  }

Â  Â  function renderManageList() {
Â  Â  Â  Â  const type = document.getElementById('manage-type-select').value;
Â  Â  Â  Â  const ul = document.getElementById('manage-list');
Â  Â  Â  Â  ul.innerHTML = (categoryData[type]||[]).map((c, i) => `<li class="cat-item"><span>${c.icon} ${c.name}</span><button style="color:red;border:none;background:none;" onclick="delCat('${type}', ${i})">åˆ é™¤</button></li>`).join('');
Â  Â  }
Â  Â  window.delCat = function(type, idx) {
Â  Â  Â  Â  if(confirm("åˆ é™¤æ­¤åˆ†ç±»ï¼Ÿ")) {
Â  Â  Â  Â  Â  Â  categoryData[type].splice(idx, 1); localStorage.setItem('categoryData', JSON.stringify(categoryData));
Â  Â  Â  Â  Â  Â  renderManageList(); updateCategoryOptions();
Â  Â  Â  Â  }
Â  Â  }
Â  Â  window.addNewCategory = function() {
Â  Â  Â  Â  const type = document.getElementById('manage-type-select').value;
Â  Â  Â  Â  const name = document.getElementById('new-cat-name').value;
Â  Â  Â  Â  const icon = document.getElementById('new-cat-icon').value || 'ğŸ·ï¸';
Â  Â  Â  Â  if(name) {
Â  Â  Â  Â  Â  Â  playSound('pop');
Â  Â  Â  Â  Â  Â  categoryData[type].push({name, icon}); localStorage.setItem('categoryData', JSON.stringify(categoryData));
Â  Â  Â  Â  Â  Â  renderManageList(); updateCategoryOptions(); document.getElementById('new-cat-name').value = ''; showToast("âœ… åˆ†ç±»å·²æ·»åŠ ");
Â  Â  Â  Â  }
Â  Â  }

Â  Â  window.exportToExcel = function() {
Â  Â  Â  Â  playSound('swoosh');
Â  Â  Â  Â  if(transactions.length===0) return showToast("æ— æ•°æ®");
Â  Â  Â  Â  let str = "\uFEFFæ—¥æœŸ,ç±»å‹,åˆ†ç±»,å¤‡æ³¨,é‡‘é¢\n";
Â  Â  Â  Â  transactions.forEach(t=> str+=`${t.date},${t.type},${t.category},${t.text},${t.amount}\n`);
Â  Â  Â  Â  const link = document.createElement('a'); link.href = 'data:text/csv;charset=utf-8,' + encodeURIComponent(str);
Â  Â  Â  Â  link.download = 'è´¦å•.csv'; link.click();
Â  Â  }
Â  Â  window.exportData = function() {
Â  Â  Â  Â  playSound('swoosh');
Â  Â  Â  Â  const str = JSON.stringify(transactions);
Â  Â  Â  Â  const link = document.createElement('a'); link.href = 'data:application/json;charset=utf-8,' + encodeURIComponent(str);
Â  Â  Â  Â  link.download = 'backup.json'; link.click();
Â  Â  }
Â  Â  window.importData = function(input) {
Â  Â  Â  Â  const file = input.files[0]; if(!file) return;
Â  Â  Â  Â  const r = new FileReader();
Â  Â  Â  Â  r.onload = e => {
Â  Â  Â  Â  Â  Â  try { transactions = JSON.parse(e.target.result); updateHomeStats(); showToast("âœ… æ•°æ®å·²æ¢å¤"); } catch(e) { showToast("âŒ æ–‡ä»¶é”™è¯¯"); }
Â  Â  Â  Â  };
Â  Â  Â  Â  r.readAsText(file);
Â  Â  Â  Â  input.value = '';
Â  Â  }

Â  Â  // åˆå§‹åŒ–æ—¥æœŸ
Â  Â  const today = new Date();
Â  Â  const y = today.getFullYear();
Â  Â  const m = String(today.getMonth() + 1).padStart(2, '0');
Â  Â  const d = String(today.getDate()).padStart(2, '0');
Â  Â Â 
Â  Â  document.getElementById('date').value = `${y}-${m}-${d}`;
Â  Â  document.getElementById('end-date').value = `${y}-${m}-${d}`;
Â  Â  document.getElementById('start-date').value = `${y}-${m}-01`;

Â  Â  updateCategoryOptions(); updateHomeStats(); checkGuide();
</script>

</body>
</html>
